import{_ as d,r as s,o as n,c as o,a as e,b as r,e as a,d as i}from"./app.cc45af49.js";const l={},c=a('<h1 id="_2-9-configuring-the-graphics-card-under-physical-machines" tabindex="-1"><a class="header-anchor" href="#_2-9-configuring-the-graphics-card-under-physical-machines" aria-hidden="true">#</a> 2.9 Configuring the Graphics Card Under Physical Machines</h1><p>FreeBSD has ported graphics drivers from Linux, and in theory, both A and N cards run properly on the AMD64 architecture.</p><h2 id="support" tabindex="-1"><a class="header-anchor" href="#support" aria-hidden="true">#</a> Support</h2><p>For FreeBSD 11, support is the same as for Linux kernel 4.11.</p><p>For FreeBSD 12, support is the same as Linux kernel 4.16.</p><p>For FreeBSD 13.1/14-current, compiled with <code>drm-510-kmod</code>, support is the same as Linux 5.10, which supports Intel 12th generation processors, and AMD supports R7 4750U.</p><p>Details can be found at</p>',7),u={href:"https://wiki.freebsd.org/Graphics",target:"_blank",rel:"noopener noreferrer"},p=i("https://wiki.freebsd.org/Graphics"),h=a(`<h2 id="intel-core-amd-solo" tabindex="-1"><a class="header-anchor" href="#intel-core-amd-solo" aria-hidden="true">#</a> Intel Core / AMD Solo</h2><h3 id="installing-drivers-simple-version-recommended" tabindex="-1"><a class="header-anchor" href="#installing-drivers-simple-version-recommended" aria-hidden="true">#</a> Installing drivers - simple version (recommended)</h3><p>First switch to the latest source or use ports to install.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>## pkg install drm-kmod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>or</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cd /usr/ports/graphics/drm-kmod/ &amp;&amp; make install clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>Note that.</p><p>The package <code>graphics/drm-kmod</code> is not real, it is just a metapackage to help determine the system version to install the corresponding ports package.</p></blockquote><blockquote><p><strong>Troubleshooting:</strong></p><p><strong>If prompted with <code>/usr/ports/xxx no such xxx</code> path not found, please fetch portsnap first: <code>portsnap fetch extract</code>. portsnap change source problem please visit previous article.</strong></p></blockquote><h3 id="installing-drivers-complex-versions" tabindex="-1"><a class="header-anchor" href="#installing-drivers-complex-versions" aria-hidden="true">#</a> Installing drivers - complex versions</h3><p>Note that to install via <code>ports</code> prompt requires source code, visit Chapter 21.</p><ul><li>FreeBSD 12</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cd /usr/ports/graphics/drm-fbsd12.0-kmod/ &amp;&amp; make install clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p><strong>Note:</strong></p><p><strong>You should install <code>drm-fbsd12.0-kmod</code> for any 12.X except 12.0, but you should rebuild it locally using the port and not using pkg, otherwise it will not work properly.</strong></p></blockquote><ul><li>FreeBSD 13</li></ul><blockquote><p>FreeBSD 13.0 can be installed using the binary package <code># pkg install drm-fbsd13-kmod</code> or compile and install <code>drm-54-kmod</code>, configured as in &quot;load graphics&quot;.</p><p>FreeBSD 13.1 requires <code>drm-510-kmod</code> to be compiled and installed via ports. Because the latter supports more graphics cards:<code># cd /usr/ports/graphics/drm-510-kmod/ &amp;&amp; make BATCH=yes install clean</code></p></blockquote><ul><li>FreeBSD 14 (current)</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cd /usr/ports/graphics/drm-510-kmod/ &amp;&amp; make BATCH=yes install clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="load-the-graphics-card" tabindex="-1"><a class="header-anchor" href="#load-the-graphics-card" aria-hidden="true">#</a> Load the graphics card</h3><blockquote><p><strong>This configuration step is required no matter which of the above methods you use.</strong></p></blockquote><p>Open <code>/etc/rc.conf</code>:</p><ul><li>If it is an intel core card, add <code>kld_list=&quot;i915kms&quot;</code></li><li>AMD <ul><li>For AMD graphics cards from HD7000 onwards, add <code>kld_list=&quot;amdgpu&quot;</code> (most people should use this, if not go back to <code>radeonkms</code>)</li><li>For AMD cards before HD7000, add <code>kld_list=&quot;radeonkms&quot;</code> (this is more than 10 years old)</li></ul></li></ul><h3 id="video-hard-decoding" tabindex="-1"><a class="header-anchor" href="#video-hard-decoding" aria-hidden="true">#</a> Video hard decoding</h3><p><code># pkg install xf86-video-intel libva-intel-driver</code></p><h3 id="brightness-adjustment" tabindex="-1"><a class="header-anchor" href="#brightness-adjustment" aria-hidden="true">#</a> Brightness adjustment</h3><h4 id="general" tabindex="-1"><a class="header-anchor" href="#general" aria-hidden="true">#</a> General</h4><p>For general computers.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>## sysrc -f /boot/loader.conf acpi_video=&quot;YES&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For Thinkpad.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># sysrc -f /boot/loader.conf acpi_ibm_load=&quot;YES&quot;
# sysrc -f /boot/loader.conf acpi_video=&quot;YES&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>FreeBSD 13 only</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># backlight decr 20 # reduce brightness by 20%
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="intel" tabindex="-1"><a class="header-anchor" href="#intel" aria-hidden="true">#</a> Intel</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># pkg install intel-backlight
# intel-backlight 80 # adjust to 80% brightness
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="amd-graphics-cards" tabindex="-1"><a class="header-anchor" href="#amd-graphics-cards" aria-hidden="true">#</a> AMD graphics cards</h2>`,34),g=e("p",null,"This part of the tutorial has been tested for renoir graphics cards.",-1),m=i("When using Gnome, if the screen is automatically locked or rested, you may not be able to access the desktop again. See "),v={href:"https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=255049",target:"_blank",rel:"noopener noreferrer"},b=i("https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=255049"),x=i("."),f=a(`<p>To install the required drivers (all latest sources or from ports).</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># pkg install drm-510-kmod gpu-firmware-kmod xf86-video-amdgpu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Create a new and edit xorg configuration file.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># ee /usr/local/etc/X11/xorg.conf.d/06-driver.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Add (<strong>Note that the BusID should be changed to your own, use <code>pciconf -l</code> to visit it</strong>).</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Section &quot;Device&quot;
    Option &quot;DRI&quot; &quot;3&quot;
    Option &quot;AccelMethod&quot; &quot;exa&quot;
    Option &quot;MigrationHeuristic&quot; &quot;greedy
    Option &quot;TearFree&quot; &quot;On&quot;
    Driver &quot;amdgpu&quot;
    BusID &quot;PCI:6:0:0&quot;
EndSection
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nvidia-graphics-card" tabindex="-1"><a class="header-anchor" href="#nvidia-graphics-card" aria-hidden="true">#</a> nvidia graphics card</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># pkg install nvidia-driver nvidia-settings nvidia-xconfig # Install several nvidia related packages
# sysrc kld_list+=&quot;nvidia-modeset&quot; # configure the driver
# reboot # reboot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You should be able to drive the graphics card by this time.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># View driver information
$ nvidia-smi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>If you find that the system is not using the nvidia driver you need to automatically generate the configuration file.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># Xorg -configure # Generate the configuration file. Note that this step is not required!
# cp /root/xorg.conf.new /etc/X11/xorg.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Then reboot and you will find the nvidia driver working properly</p><p><strong>NOTE</strong>: By default, nvidia-driver installed via pkg includes Linux compatibility layer support, to use Linux software, you need to execute the following command, (Actually, to use linux compatibility layer, the following command is required.) If you do not need to use the Linux compatibility layer, you do not need to execute it.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># sysrc linux_enable=&quot;YES&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Of course if you use the official pkg package, after installing the driver and rebooting.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ kldstat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>You will find that the <code>linux.ko</code> module is loaded automatically. If you think it&#39;s too bloated and don&#39;t need the Linux compatibility layer, you can compile <code>nvidia-driver</code> yourself via ports, removing the <code>linux compatibility support</code>.</p>`,18);function k(q,y){const t=s("ExternalLinkIcon");return n(),o("div",null,[c,e("p",null,[e("a",u,[p,r(t)])]),h,e("blockquote",null,[g,e("p",null,[m,e("a",v,[b,r(t)]),x])]),f])}var D=d(l,[["render",k],["__file","2.9-configuration-of-the-graphics-card-under-the-physical-machine.html.vue"]]);export{D as default};
