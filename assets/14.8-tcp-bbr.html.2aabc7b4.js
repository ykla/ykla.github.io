import{_ as n,r as o,o as d,c as i,a as e,b as a,e as r,d as c}from"./app.78907f2c.js";const s={},l=r(`<h1 id="_14-8-tcp-bbr" tabindex="-1"><a class="header-anchor" href="#_14-8-tcp-bbr" aria-hidden="true">#</a> 14.8 TCP BBR</h1><p>TCP BBR is a congestion control algorithm developed by Google. The effect is twofold.</p><ol><li><p><strong>Make full use of bandwidth on network links that have a certain packet loss rate.</strong></p></li><li><p><strong>Reduces buffer occupancy on a network link, thus reducing latency.</strong></p></li></ol><p>In general, if you use proxy software, it is recommended to turn on the TCP BBR feature, which will have a very significant effect in terms of speed and stability. This project is in FreeBSD and was developed with the help of the Netflix team. Minimum system version support: <em>r363032</em>, which means that FreeBSD 13.0 is recommended.</p><h2 id="modify-the-kernel-configuration" tabindex="-1"><a class="header-anchor" href="#modify-the-kernel-configuration" aria-hidden="true">#</a> Modify the kernel configuration</h2><p><code># cd /usr/src/sys/amd64/conf</code></p><p>If you did not choose to install the kernel source code when installing FreeBSD, we recommend reading the later section.</p><p><code># cp GENERIC GENERIC-bbr</code></p><p><code># ee GENERIC-bbr</code></p><p>Adjust the configuration by changing the value of <code>ident</code> to <code>GENERIC-bbr</code> and adding the following items under the <code>ident</code> entry.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>options TCPHPTS
options RATELIMIT
makeoptions WITH_EXTRA_TCP_STACKS=1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Create a new <code>/etc/src.conf</code> with the following content:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>KERNCONF=GENERIC-bbr
MALLOC_PRODUCTION=yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="compile-and-install-the-kernel" tabindex="-1"><a class="header-anchor" href="#compile-and-install-the-kernel" aria-hidden="true">#</a> Compile and install the kernel</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># /usr/sbin/config GENERIC-bbr
# cd ... /compile/GENERIC-bbr
# make cleandepend &amp;&amp; make depend
# make -jN+1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>where <code>N</code> is suggested to be the <code>CPU core count</code>.</p><p><code># make install</code></p><p>Install the kernel, and reboot to use the new kernel when finished.</p><p><code># uname -a</code></p><p>If <code>GENERIC-bbr</code> is displayed, the TCP BBR kernel is compiled and installed successfully.</p><h2 id="configure-and-load-the-bbr-module" tabindex="-1"><a class="header-anchor" href="#configure-and-load-the-bbr-module" aria-hidden="true">#</a> Configure and load the BBR module</h2><p><code># sysrc kld_list+=&quot;tcp_rack tcp_bbr&quot;</code></p><p>Load the BBR module at boot time.</p><p><code># echo &#39;net.inet.tcp.functions_default=bbr&#39; &gt;&gt; /etc/sysctl.conf</code></p><p>Set the default to use BBR and reboot.</p><p><code># sysctl net.inet.tcp.functions_default</code></p><p>If the result is <code>net.inet.tcp.functions_default: bbr</code>, then TCP BBR is enabled successfully.</p><p><strong>Note:</strong> For troubleshooting and other matters, please refer to.</p>`,28),p={href:"https://github.com/netflix/tcplog_dumper",target:"_blank",rel:"noopener noreferrer"},h=c("https://github.com/netflix/tcplog_dumper");function u(m,b){const t=o("ExternalLinkIcon");return d(),i("div",null,[l,e("p",null,[e("a",p,[h,a(t)])])])}var g=n(s,[["render",u],["__file","14.8-tcp-bbr.html.vue"]]);export{g as default};
